---
title: "账号和权限管理"
date: 2018-05-27T16:15:57+08:00
description: ""
draft: false
tags: ["权限管理"]
categories: ["Linux运维"]
---

<!--more-->

# 一、用户和组账号的概述；

## 1.概念：用户：包含一个名和密码，人在计算机中的体现方式，包含root、普通用户、程序用户；

	组：用户的集合，批量管理用户群权限，包含基本组、附加组（一个用户只能属于一个基本组，但是可以属于多个附加组）；
	权限：限制用户访问资源（文件、app、进程、硬件等）；
	UID：每个用户账号都有一个数字标识（身份证），root（0）、普通用户（500-60000）、程序用户（1-499）；
	GID：每个组账号的唯一身份标识；root（0）、普通组账号（500-60000）、程序组账号（1-499）；

## 2.用户和组的文件；

```
/etc/passwd	##账号文件
/etc/shadow	##密码文件
/etc/group	##组账号文件
/etc/gshadow	##组密码文件，很少使用
```

## 3.用户账号文件格式：/etc/passwd

    用户名：密码占位符：UID：GID：全名：家目录：登陆shell解释器
    密码占位符：可能是以密文的字符串代表或者X密码占位符；
    登陆shell解释器：用户默认的的解释器，默认情况用户使用/bin/bash作为shell，若修改为/sbin/nologin（禁止登陆），

## 4.用户密码文件格式；/etc/shadow

```
用户名：MD5加密的密码字串信息：上次修改密码到现在的时间：密码最短有效天数：密码最长有效天数：提前几天警	告用户密码将要过期：在密码过期多少天后禁用账户：账号失效时间（默认为空，表示永久）；保留字段
密码字串信息：
!!：未初始化密码，新建用户的默认状态
密码字符串：修改密码后的状态
!!加密字符串或*加密字符串：密码被锁定，不能登陆
空：登陆不需要密码，只能本地登录（无需密码）
```

## 5.组账号文件：/etc/group

```
组名：密码占位符：GID：成员列表
```

# 二、用户及组账号的管理；


## 1.用户的管理：

```
增：useradd 选项 用户名
选项：-d	##指定家目录		
     -M   ##不指定家目录
	 -s	  ##指定用户的登陆shell
	 -g	  ##指定用户的基本组
	 -G	  ##指定用户的附加组（可指定GID）
删：userdel -r 用户名
    删除用户的同时也将家目录一并删除
改：usermod 选项 用户名
选项：包含创建用户的所有选项
  	 passwd 用户名		##为用户设置密码
	 passwd 选项 用户名
	 选项：-d	##清空用户的密码（不用密码登录）
		  -l		##锁定用户
		  -u		##解锁用户
		  -S		##查看用户锁定状态
	chsh -s 解释器目录 用户名	##更改用户的shell解释器
查：
	grep 用户名 /etc/passwd		##查看账号信息
	id 用户名	##显示用户UID和所属组
	w		##查看当前主机的登陆情况
```

## 2.组的管理：

```
增：groupadd 组名
	选项-g可指定GID；
删：groupdel 组名
改：gpasswd 选项 用户名 组名
选项：-a 	##将单个用户添加到某个组
	 -M  ##将多个用户添加到某个组，用户之间用逗号隔开
	 -d	 ##将某个用户在某个组中删除
查：
	groups 用户名		##查看用户属于哪个组
	grep 组名	/etc/group		##查看组信息
```

# 三、管理目录及文件的属性；


## 1.概念：

- `访问权限`：读取（r）、写入（w）、执行（x）
- `归属`：属主：拥有该文件的用户
  	  
-  `属组`：拥有该文件的组账号

## 2.查看文件或目录的属性：

  ls -ld 目录或文件位置

  `格式`：文件类型、权限、inode数量、属主、属组、大小、日期、文件名
  权限列表：

- `第一个字符`：文件类型，d目录、b块设备文件、c字符设备文件、l链接文件、-普通文件；
- `第2-4个字符`：属主对文件的权限；
- `第5-7个字符`：属组对文件的权限；
- `第8-10个字符`：任何用户对文件的权限；

 权限的表示：

-  `r`：读取，查看内容，也可以用4表示；
- `w`：写入，写入（删除、更改、移动等）内容，也可用2表示；
- `x`：执行，执行此文件或cd到此目录，也可用1表示；

  ## 3.设置文件或目录的权限；

	语法：chmod [ugoa] [+-=] [rwx] 文件或目录
	举例：chmod g-x, o-r 文件或目录
	选项：-R 表示递归权限，目录下的子目录子文件继承父级目录的权限；
	语法：chmod 775 文件或目录

## 4.设置目录或文件的归属；

	语法：chown 属主 文件或目录		##设置其属主
		 chown :属组 文件或目录		##设置其属组
		 chown 属主:属组 文件或目录		##设置其属主和属组
	注：选项-R 递归可将其子目录子文件继承父级目录的归属；

# 四、扩展：

## 1.umask文件反权限：

- `umask	`			##查看系统的默认权限反掩码值，文件最大权限为666，目录最大权限为777

- `umask ###`			##手动更改文件权限的反掩码值，更改后创建文件或目录验证反掩码值

## 2.chattr锁定文件：

- `chattr +i 文件路径	`	##锁定文件，不得移动删除等

- ` chattr -i 文件路径	`	##解锁文件

